{% extends 'base.html' %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
  <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow">

    {% if product.image %}
      <img src="{{ product.image.url }}" alt="{{ product.name }}"
           class="w-full h-96 object-contain mb-4 rounded" />
    {% endif %}

    <h2 class="text-3xl font-bold mb-2">{{ product.name }}</h2>
    <p class="text-green-600 text-xl font-semibold mb-4">‚Çπ{{ product.price }}</p>

    <p class="mb-2 text-gray-700">
      <strong>Category:</strong> {{ product.category.name }} ‚Üí {{ product.subcategory.name }}
    </p>

    <p class="text-gray-600 mb-6"><strong>Supplier:</strong> {{ product.supplier.username }}</p>

    <p class="whitespace-pre-line leading-relaxed text-gray-800 text-[17px] mb-8">
      {{ product.description|linebreaksbr }}
    </p>

    <!-- üßæ Customer Reviews Section -->
    <div class="mt-10 bg-gray-50 p-6 rounded-xl shadow">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Customer Reviews</h3>

      {% if product.reviews.all %}
        <div class="space-y-4">
          {% for review in product.reviews.all %}
            <div class="bg-white rounded p-4 shadow border">
              <div class="flex justify-between items-center mb-2">
                <p class="font-semibold text-indigo-700">{{ review.user.username }}</p>
                <p class="text-yellow-500 text-sm">
                  {% for i in "12345"|slice:":review.rating"|make_list %}‚≠ê{% endfor %}
                </p>
              </div>
              <p class="text-gray-700">{{ review.comment|linebreaksbr }}</p>
              <p class="text-sm text-gray-500 mt-1">Posted on {{ review.created_at|date:"d M Y" }}</p>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-gray-500">No reviews yet. Be the first to review this product!</p>
      {% endif %}
    </div>

    <!-- ‚úçÔ∏è Add Review Form -->
    {% if user.is_authenticated %}
      <form method="POST" action="{% url 'add_review' product.id %}" class="mt-8 bg-white p-5 rounded-xl shadow">
        {% csrf_token %}
        <label for="rating" class="block font-semibold mb-1">Rating:</label>
        <select name="rating" class="w-full mb-3 rounded p-2 border" required>
          {% for i in "12345" %}
            <option value="{{ i }}">{{ i }} Star</option>
          {% endfor %}
        </select>

        <label for="comment" class="block font-semibold mb-1">Your Review:</label>
        <textarea name="comment" rows="3" class="w-full rounded p-2 border mb-3" required></textarea>

        <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
          Submit Review
        </button>
      </form>
    {% else %}
      <p class="mt-4 text-gray-600">Please <a href="{% url 'login' %}" class="text-indigo-600 underline">log in</a> to write a review.</p>
    {% endif %}

  </div>
{% endblock %}
